<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Produção de Asfalto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 0; 
      padding: 0;
      background: #f4f4f4;
    }
    .container { max-width: 960px; margin: 0 auto; padding: 20px; }

    h2 { font-size: 1.5rem; text-align: center; margin-bottom: 8px; }
    p { font-size: 1rem; text-align: center; margin-bottom: 12px; }

    .card { background:#fff; border-radius:12px; padding:16px; box-shadow:0 0 10px rgba(0,0,0,.07); margin-bottom:12px; }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap:12px; }
    .col-12{grid-column: span 12;} 
    .col-6{grid-column: span 6;} 
    .col-4{grid-column: span 4;}
    .col-3{grid-column: span 3;}

    label { display:block; font-size:.9rem; margin-bottom:6px; color:#333; }
    input[type="text"], input[type="number"] { 
      padding: 8px 10px; 
      width: 100%; 
      font-size: 0.95rem; 
      border-radius: 8px;
      border: 2px solid #ccc;
      box-sizing: border-box;
      text-align: center;
      background:#fff;
    }
    button { 
      padding: 14px; 
      width: 100%; 
      font-size: 1.05rem; 
      border-radius: 8px;
      background-color: #007bff; 
      color: #fff; 
      border: none; 
      cursor: pointer; 
      font-weight: bold;
    }
    button:hover { background-color: #0056b3; }

    .result { 
      background: #fff; 
      padding: 16px; 
      margin-top: 15px; 
      border-radius: 12px; 
      font-size: 1rem;
      line-height: 1.45;
      box-shadow: 0 0 10px rgba(0,0,0,0.08);
    }
    .muted { color:#555; font-size: .86rem; text-align:center; margin-top:8px; }

    @media (max-width: 768px) {
      .grid { gap:10px; }
      .col-6, .col-4, .col-3 { grid-column: span 12; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Calculadora de Produção de Asfalto</h2>
    <p>Informe o orçamento, ajuste o traço, preços e calcule a produção estimada.</p>

    <!-- Valor disponível -->
    <div class="card">
      <label for="valorDisponivel">Valor disponível (R$)</label>
      <input type="text" id="valorDisponivel" placeholder="Ex: 50.000,00" inputmode="numeric" />
    </div>

    <!-- Traço do agregado -->
    <div class="card">
      <h3 style="margin:0 0 10px 0; font-size:1.05rem;">Traço do agregado (editável)</h3>
      <div class="grid" style="margin-bottom:10px;">
        <div class="col-4">
          <label for="percBrita">Brita 0 (% sobre o agregado)</label>
          <input type="number" id="percBrita" value="40.0" step="0.1" />
        </div>
        <div class="col-4">
          <label for="percPo">Pó de pedra (% sobre o agregado)</label>
          <input type="number" id="percPo" value="42.0" step="0.1" />
        </div>
        <div class="col-4">
          <label for="percAreia">Areia (% sobre o agregado)</label>
          <input type="number" id="percAreia" value="18.0" step="0.1" />
        </div>
      </div>

      <div class="grid">
        <div class="col-4">
          <label for="percEmulsao">% Emulsão RL-1C (sobre o agregado)</label>
          <input type="number" id="percEmulsao" min="0" max="20" step="0.1" value="9" />
        </div>
      </div>

      <p class="muted">
        Agregado base = 1.000 kg. Os percentuais de Brita 0, Pó e Areia podem ser ajustados; 
        o cálculo normaliza automaticamente para somar 100%.
      </p>
    </div>

    <!-- Parâmetros econômicos -->
    <div class="card">
      <h3 style="margin:0 0 10px 0; font-size:1.05rem;">Parâmetros econômicos (editáveis)</h3>
      <div class="grid" style="margin-bottom:8px;">
        <div class="col-3">
          <label for="precoBrita">Preço Brita 0 (R$/t)</label>
          <input type="text" id="precoBrita" value="120,00" />
        </div>
        <div class="col-3">
          <label for="precoPo">Preço Pó (R$/t)</label>
          <input type="text" id="precoPo" value="75,00" />
        </div>
        <div class="col-3">
          <label for="precoAreia">Preço Areia (R$/t)</label>
          <input type="text" id="precoAreia" value="44,50" />
        </div>
        <div class="col-3">
          <label for="precoEmulsao">Preço Emulsão RL-1C (R$/t)</label>
          <input type="text" id="precoEmulsao" value="3.900,00" />
        </div>
      </div>

      <div class="grid">
        <div class="col-3">
          <label for="densAreia">Densidade Areia (t/m³)</label>
          <input type="number" id="densAreia" value="1.5" step="0.01" />
        </div>
        <div class="col-3">
          <label for="percMaoDeObra">% Mão de obra sobre materiais</label>
          <input type="number" id="percMaoDeObra" value="12" step="0.1" />
        </div>
      </div>

      <p class="muted">
        A areia é convertida de R$/t para R$/m³ usando o preço por tonelada e a densidade informada.
        A mão de obra é calculada como um percentual sobre o custo total dos materiais.
      </p>
    </div>

    <!-- Botão -->
    <div class="card">
      <button id="btnCalcular">Calcular</button>
    </div>

    <!-- Resultado -->
    <div id="resultado" class="result"></div>

    <p class="muted">
      Densidade de referência da mistura: 1,89 t/m³ (usada para converter t ↔ m³).  
      Ajuste os valores conforme seus orçamentos reais.
    </p>
  </div>

  <script>
    // ------- Utilidades -------
    function formatarBR(valor) {
      return (isFinite(valor) ? Number(valor) : 0).toLocaleString('pt-BR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function desformatarBR(valor) {
      if (typeof valor !== 'string') return 0;
      const limpo = valor.replace(/\./g, '').replace(',', '.').replace(/[^0-9.]/g, '');
      const num = parseFloat(limpo);
      return isNaN(num) ? 0 : num;
    }

    // Densidade de referência da mistura (t/m³)
    const densMisturaRef = 1.89;

    // Formatação de campos monetários
    function configurarCampoMonetario(id) {
      const el = document.getElementById(id);
      el.addEventListener("input", function () {
        const dig = this.value.replace(/\D/g, '');
        const val = (parseInt(dig || '0', 10) / 100).toFixed(2);
        this.value = Number(val).toLocaleString("pt-BR", { minimumFractionDigits: 2 });
      });
    }

    configurarCampoMonetario("valorDisponivel");
    configurarCampoMonetario("precoBrita");
    configurarCampoMonetario("precoPo");
    configurarCampoMonetario("precoAreia");
    configurarCampoMonetario("precoEmulsao");

    document.getElementById('btnCalcular').addEventListener('click', calcular);

    function calcularLote(params) {
      const {
        percBrita, percPo, percAreia, percEmulsao,
        precoTonBrita, precoTonPo, precoTonAreia, precoTonEmulsao
      } = params;

      const A = 1000; // agregado base em kg

      // Normaliza percentuais para somarem 100
      const somaPerc = percBrita + percPo + percAreia;
      const fator = somaPerc > 0 ? (1 / somaPerc) : 0;

      const massaBrita  = A * percBrita  * fator;
      const massaPo     = A * percPo     * fator;
      const massaAreia  = A * percAreia  * fator;

      // Emulsão RL-1C: % sobre o agregado (base 1.000 kg), 1% = 10 kg
      const massaEmulsao = percEmulsao * 10;

      const massaMistura = A + massaEmulsao;

      const custoLoteMateriais =
          (massaBrita  / 1000) * precoTonBrita  +
          (massaPo     / 1000) * precoTonPo     +
          (massaAreia  / 1000) * precoTonAreia  +
          (massaEmulsao/ 1000) * precoTonEmulsao;

      const volumeMistura = (massaMistura / 1000) / densMisturaRef;
      const custoTonMisturaMateriais = custoLoteMateriais * (1000 / massaMistura);

      return {
        massaBrita,
        massaPo,
        massaAreia,
        massaEmulsao,
        massaMistura,
        volumeMistura,
        custoTonMisturaMateriais,
        m3PorTon: 1 / densMisturaRef,
        densMistura: densMisturaRef
      };
    }

    function calcular() {
      const valorDisponivel = desformatarBR(document.getElementById("valorDisponivel").value);

      if (!isFinite(valorDisponivel) || valorDisponivel <= 0) {
        alert("Informe um valor disponível válido.");
        return;
      }

      // Traço
      const percBrita   = Number(document.getElementById("percBrita").value)   || 0;
      const percPo      = Number(document.getElementById("percPo").value)      || 0;
      const percAreia   = Number(document.getElementById("percAreia").value)   || 0;
      const percEmulsao = Number(document.getElementById("percEmulsao").value) || 0;

      // Preços (R$/t)
      const precoTonBrita   = desformatarBR(document.getElementById("precoBrita").value);
      const precoTonPo      = desformatarBR(document.getElementById("precoPo").value);
      const precoTonAreia   = desformatarBR(document.getElementById("precoAreia").value);
      const precoTonEmulsao = desformatarBR(document.getElementById("precoEmulsao").value);

      // Densidade da areia (t/m³)
      const densAreia = Number(document.getElementById("densAreia").value) || 1.5;

      // % mão de obra
      const percMaoDeObra = (Number(document.getElementById("percMaoDeObra").value) || 0) / 100;

      const r = calcularLote({
        percBrita, percPo, percAreia, percEmulsao,
        precoTonBrita, precoTonPo, precoTonAreia, precoTonEmulsao
      });

      // Custo por tonelada
      const custoTonMateriais = r.custoTonMisturaMateriais;
      const custoTonTotal = custoTonMateriais * (1 + percMaoDeObra);

      // Produção possível
      const toneladasMistura = valorDisponivel / custoTonTotal;
      const m3Asfalto = toneladasMistura * r.m3PorTon;

      // Frações em kg/kg de mistura
      const fracBrita   = r.massaBrita   / r.massaMistura;
      const fracPo      = r.massaPo      / r.massaMistura;
      const fracAreia   = r.massaAreia   / r.massaMistura;
      const fracEmulsao = r.massaEmulsao / r.massaMistura;

      // Toneladas totais de cada insumo
      const tBrita   = toneladasMistura * fracBrita;
      const tPo      = toneladasMistura * fracPo;
      const tAreia   = toneladasMistura * fracAreia;
      const tEmulsao = toneladasMistura * fracEmulsao;

      // Custos por insumo (materiais)
      const valorBrita   = tBrita   * precoTonBrita;
      const valorPo      = tPo      * precoTonPo;
      const valorAreia   = tAreia   * precoTonAreia;
      const valorEmulsao = tEmulsao * precoTonEmulsao;

      const totalMateriais = valorBrita + valorPo + valorAreia + valorEmulsao;
      const valorMaoDeObra = totalMateriais * percMaoDeObra;
      const totalComMO = totalMateriais + valorMaoDeObra;

      // Áreas e comprimentos
      const area3 = m3Asfalto / 0.03;
      const area4 = m3Asfalto / 0.04;
      const area5 = m3Asfalto / 0.05;

      const comp3 = area3 / 7;
      const comp4 = area4 / 7;
      const comp5 = area5 / 7;

      // Custos unitários
      const custoM3Total = custoTonTotal / r.m3PorTon;
      const custoM2_3 = custoM3Total * 0.03;
      const custoM2_4 = custoM3Total * 0.04;
      const custoM2_5 = custoM3Total * 0.05;

      // Conversão areia: R$/m³
      const precoM3Areia = precoTonAreia * densAreia;

      // Monta resultado
      document.getElementById('resultado').innerHTML = `
        <h3 style="margin-top:0;">Resultados</h3>

        <p><strong>Produção estimada:</strong> ${formatarBR(m3Asfalto)} m³ 
        (${formatarBR(toneladasMistura)} t de mistura pronta)</p>

        <p><strong>Densidade adotada da mistura:</strong> ${formatarBR(r.densMistura)} t/m³ 
        (m³/t = ${formatarBR(r.m3PorTon)})</p>

        <h3>Traço por tonelada de mistura</h3>
        <ul>
          <li>Brita 0: ${formatarBR(fracBrita * 1000)} kg</li>
          <li>Pó de pedra: ${formatarBR(fracPo * 1000)} kg</li>
          <li>Areia: ${formatarBR(fracAreia * 1000)} kg</li>
          <li>Emulsão RL-1C: ${formatarBR(fracEmulsao * 1000)} kg 
              (${formatarBR(r.massaEmulsao / 10)}% sobre o agregado base)</li>
        </ul>

        <h3>Áreas pavimentadas</h3>
        <ul>
          <li>3 cm: ${formatarBR(area3)} m² (${formatarBR(comp3)} m de extensão a 7 m de largura)</li>
          <li>4 cm: ${formatarBR(area4)} m² (${formatarBR(comp4)} m)</li>
          <li>5 cm: ${formatarBR(area5)} m² (${formatarBR(comp5)} m)</li>
        </ul>

        <h3>Custos</h3>
        <ul>
          <li>Custo por tonelada (apenas materiais): R$ ${formatarBR(custoTonMateriais)}</li>
          <li>Custo por tonelada (materiais + mão de obra): R$ ${formatarBR(custoTonTotal)}</li>
          <li>Custo por m³ (total): R$ ${formatarBR(custoM3Total)}</li>
          <li>Custo por m² (3 cm): R$ ${formatarBR(custoM2_3)}</li>
          <li>Custo por m² (4 cm): R$ ${formatarBR(custoM2_4)}</li>
          <li>Custo por m² (5 cm): R$ ${formatarBR(custoM2_5)}</li>
        </ul>

        <h3>Mão de obra (separada)</h3>
        <ul>
          <li>Percentual de mão de obra: ${formatarBR(percMaoDeObra * 100)} %</li>
          <li>Valor da mão de obra (sobre materiais): R$ ${formatarBR(valorMaoDeObra)}</li>
          <li>Total geral (materiais + mão de obra): R$ ${formatarBR(totalComMO)}</li>
        </ul>

        <h3>Insumos totais</h3>
        <ul>
          <li>Brita 0: ${formatarBR(tBrita)} t — R$ ${formatarBR(valorBrita)}</li>
          <li>Pó de pedra: ${formatarBR(tPo)} t — R$ ${formatarBR(valorPo)}</li>
          <li>Areia: ${formatarBR(tAreia)} t — R$ ${formatarBR(valorAreia)}</li>
          <li>Emulsão RL-1C: ${formatarBR(tEmulsao)} t — R$ ${formatarBR(valorEmulsao)}</li>
          <li><strong>Total materiais:</strong> R$ ${formatarBR(totalMateriais)}</li>
        </ul>

        <h3>Conversão da areia (t ↔ m³)</h3>
        <ul>
          <li>Densidade considerada da areia: ${formatarBR(densAreia)} t/m³</li>
          <li>Preço da areia: R$ ${formatarBR(precoTonAreia)} por tonelada</li>
          <li><strong>Preço equivalente:</strong> R$ ${formatarBR(precoM3Areia)} por m³</li>
        </ul>
      `;
    }
  </script>
</body>
</html>
