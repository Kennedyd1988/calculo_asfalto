<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Produção de Asfalto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 0; 
      padding: 0;
      background: #f4f4f4;
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

    h2 { font-size: 1.5rem; text-align: center; margin-bottom: 8px; }
    p { font-size: 1rem; text-align: center; margin-bottom: 12px; }

    .card { background:#fff; border-radius:12px; padding:16px; box-shadow:0 0 10px rgba(0,0,0,.07); margin-bottom:12px; }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap:12px; }
    .col-12{grid-column: span 12;} 
    .col-6{grid-column: span 6;} 
    .col-4{grid-column: span 4;}
    .col-3{grid-column: span 3;}

    label { display:block; font-size:.9rem; margin-bottom:6px; color:#333; }
    input[type="text"], input[type="number"] { 
      padding: 8px 10px; 
      width: 100%; 
      font-size: 0.95rem; 
      border-radius: 8px;
      border: 2px solid #ccc;
      box-sizing: border-box;
      text-align: center;
      background:#fff;
    }
    button { 
      padding: 14px; 
      width: 100%; 
      font-size: 1.05rem; 
      border-radius: 8px;
      background-color: #007bff; 
      color: #fff; 
      border: none; 
      cursor: pointer; 
      font-weight: bold;
    }
    button:hover { background-color: #0056b3; }

    .result { 
      background: #fff; 
      padding: 16px; 
      margin-top: 15px; 
      border-radius: 12px; 
      font-size: 1rem;
      line-height: 1.45;
      box-shadow: 0 0 10px rgba(0,0,0,0.08);
    }
    .muted { color:#555; font-size: .86rem; text-align:center; margin-top:8px; }

    /* Tabelas */
    table { width:100%; border-collapse: collapse; margin:10px 0 16px; font-size:0.95rem; }
    th, td { border:1px solid #ddd; padding:10px; text-align:center; }
    th { background:#f2f2f2; font-weight:700; }
    .right { text-align:right; }
    .left { text-align:left; }
    .total-row td { font-weight:700; background:#fafafa; }

    @media (max-width: 768px) {
      .grid { gap:10px; }
      .col-6, .col-4, .col-3 { grid-column: span 12; }
      table { font-size:0.9rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Calculadora de Produção de Asfalto</h2>
    <p>Informe o orçamento, ajuste o traço, preços e calcule a produção estimada.</p>

    <!-- Valor disponível -->
    <div class="card">
      <label for="valorDisponivel">Valor disponível (R$)</label>
      <input type="text" id="valorDisponivel" placeholder="Ex: 50.000,00" inputmode="numeric" />
    </div>

    <!-- Traço do agregado -->
    <div class="card">
      <h3 style="margin:0 0 10px 0; font-size:1.05rem;">Traço do agregado (editável)</h3>
      <div class="grid" style="margin-bottom:10px;">
        <div class="col-4">
          <label for="percBrita">Brita 0 (% sobre o agregado)</label>
          <input type="number" id="percBrita" value="40.0" step="0.1" />
        </div>
        <div class="col-4">
          <label for="percPo">Pó de pedra (% sobre o agregado)</label>
          <input type="number" id="percPo" value="42.0" step="0.1" />
        </div>
        <div class="col-4">
          <label for="percAreia">Areia (% sobre o agregado)</label>
          <input type="number" id="percAreia" value="18.0" step="0.1" />
        </div>
      </div>

      <div class="grid">
        <div class="col-4">
          <label for="percEmulsao">% Emulsão RL-1C (sobre o agregado)</label>
          <input type="number" id="percEmulsao" min="0" max="20" step="0.1" value="9" />
        </div>
      </div>

      <p class="muted">
        Agregado base = 1.000 kg. Os percentuais de Brita 0, Pó e Areia podem ser ajustados; 
        o cálculo normaliza automaticamente para somar 100%.
      </p>
    </div>

    <!-- Parâmetros econômicos -->
    <div class="card">
      <h3 style="margin:0 0 10px 0; font-size:1.05rem;">Parâmetros econômicos (editáveis)</h3>
      <div class="grid" style="margin-bottom:8px;">
        <div class="col-3">
          <label for="precoBrita">Preço Brita 0 (R$/t)</label>
          <input type="text" id="precoBrita" value="114,70" />
        </div>
        <div class="col-3">
          <label for="precoPo">Preço Pó de Pedra (R$/t)</label>
          <input type="text" id="precoPo" value="77,80" />
        </div>
        <div class="col-3">
          <label for="precoAreia">Preço Areia (R$/m³)</label>
          <input type="text" id="precoAreia" value="66,75" />
        </div>
        <div class="col-3">
          <label for="precoEmulsao">Preço Emulsão RL-1C (R$/t)</label>
          <input type="text" id="precoEmulsao" value="3.520,00" />
        </div>
      </div>

      <div class="grid">
        <div class="col-3">
          <label for="densAreia">Densidade Areia (t/m³)</label>
          <input type="number" id="densAreia" value="1.5" step="0.01" />
        </div>
        <div class="col-3">
          <label for="percMaoDeObra">% Mão de obra sobre materiais</label>
          <input type="number" id="percMaoDeObra" value="12" step="0.1" />
        </div>
      </div>

      <p class="muted">
        A areia é informada em R$/m³ e convertida internamente conforme a densidade.  
        A mão de obra é calculada como um percentual sobre o custo total dos materiais.
      </p>
    </div>

    <!-- Botão -->
    <div class="card">
      <button id="btnCalcular">Calcular</button>
    </div>

    <!-- Resultado -->
    <div id="resultado" class="result"></div>

    <p class="muted">
      Densidade de referência da mistura: 1,89 t/m³ (usada para converter t ↔ m³).  
      Ajuste os valores conforme seus orçamentos reais.
    </p>
  </div>

  <script>
    // ------- Utilidades -------
    function formatarBR(valor) {
      return (isFinite(valor) ? Number(valor) : 0).toLocaleString('pt-BR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function desformatarBR(valor) {
      if (typeof valor !== 'string') return 0;
      const limpo = valor.replace(/\./g, '').replace(',', '.').replace(/[^0-9.]/g, '');
      const num = parseFloat(limpo);
      return isNaN(num) ? 0 : num;
    }

    // Densidade de referência da mistura (t/m³)
    const densMisturaRef = 1.89;

    // Formatação de campos monetários
    function configurarCampoMonetario(id) {
      const el = document.getElementById(id);
      el.addEventListener("input", function () {
        const dig = this.value.replace(/\D/g, '');
        const val = (parseInt(dig || '0', 10) / 100).toFixed(2);
        this.value = Number(val).toLocaleString("pt-BR", { minimumFractionDigits: 2 });
      });
    }

    configurarCampoMonetario("valorDisponivel");
    configurarCampoMonetario("precoBrita");
    configurarCampoMonetario("precoPo");
    configurarCampoMonetario("precoAreia");
    configurarCampoMonetario("precoEmulsao");

    document.getElementById('btnCalcular').addEventListener('click', calcular);

    function calcularLote(params) {
      const {
        percBrita, percPo, percAreia, percEmulsao,
        precoTonBrita, precoTonPo, precoM3Areia, precoTonEmulsao,
        densAreia
      } = params;

      const A = 1000; // agregado base em kg

      // Normaliza percentuais para somarem 100
      const somaPerc = percBrita + percPo + percAreia;
      const fator = somaPerc > 0 ? (1 / somaPerc) : 0;

      const massaBrita  = A * percBrita  * fator;
      const massaPo     = A * percPo     * fator;
      const massaAreia  = A * percAreia  * fator;

      // Emulsão RL-1C: % sobre o agregado (base 1.000 kg), 1% = 10 kg
      const massaEmulsao = percEmulsao * 10;

      const massaMistura = A + massaEmulsao;

      // Custos do lote (materiais)
      const custoBrita  = (massaBrita  / 1000) * precoTonBrita;
      const custoPo     = (massaPo     / 1000) * precoTonPo;
      const volumeAreiaLoteM3 = (massaAreia / 1000) / densAreia; // t / (t/m³) = m³
      const custoAreia  = volumeAreiaLoteM3 * precoM3Areia;
      const custoEmulsao = (massaEmulsao / 1000) * precoTonEmulsao;

      const custoLoteMateriais = custoBrita + custoPo + custoAreia + custoEmulsao;

      const volumeMistura = (massaMistura / 1000) / densMisturaRef;
      const custoTonMisturaMateriais = custoLoteMateriais * (1000 / massaMistura);

      return {
        massaBrita,
        massaPo,
        massaAreia,
        massaEmulsao,
        massaMistura,
        volumeMistura,
        custoTonMisturaMateriais,
        m3PorTon: 1 / densMisturaRef,
        densMistura: densMisturaRef
      };
    }

    function calcular() {
      const valorDisponivel = desformatarBR(document.getElementById("valorDisponivel").value);

      if (!isFinite(valorDisponivel) || valorDisponivel <= 0) {
        alert("Informe um valor disponível válido.");
        return;
      }

      // Traço
      const percBrita   = Number(document.getElementById("percBrita").value)   || 0;
      const percPo      = Number(document.getElementById("percPo").value)      || 0;
      const percAreia   = Number(document.getElementById("percAreia").value)   || 0;
      const percEmulsao = Number(document.getElementById("percEmulsao").value) || 0;

      // Preços
      const precoTonBrita   = desformatarBR(document.getElementById("precoBrita").value);
      const precoTonPo      = desformatarBR(document.getElementById("precoPo").value);
      const precoM3Areia    = desformatarBR(document.getElementById("precoAreia").value); // R$/m³
      const precoTonEmulsao = desformatarBR(document.getElementById("precoEmulsao").value);

      // Densidade da areia (t/m³)
      const densAreia = Number(document.getElementById("densAreia").value) || 1.5;

      // % mão de obra
      const percMaoDeObra = (Number(document.getElementById("percMaoDeObra").value) || 0) / 100;

      const r = calcularLote({
        percBrita, percPo, percAreia, percEmulsao,
        precoTonBrita, precoTonPo, precoM3Areia, precoTonEmulsao,
        densAreia
      });

      // Custo por tonelada (materiais) e com mão de obra
      const custoTonMateriais = r.custoTonMisturaMateriais;
      const custoTonTotal = custoTonMateriais * (1 + percMaoDeObra);

      // Produção possível
      const toneladasMistura = valorDisponivel / custoTonTotal;
      const m3Asfalto = toneladasMistura * r.m3PorTon;

      // Frações em t por t de mistura (proporção)
      const fracBrita   = r.massaBrita   / r.massaMistura;
      const fracPo      = r.massaPo      / r.massaMistura;
      const fracAreia   = r.massaAreia   / r.massaMistura;
      const fracEmulsao = r.massaEmulsao / r.massaMistura;

      // Traço em toneladas por 1 tonelada de mistura
      const tBritaPorTonMist   = fracBrita; 
      const tPoPorTonMist      = fracPo;
      const tAreiaPorTonMist   = fracAreia;
      const tEmulsaoPorTonMist = fracEmulsao;

      // Toneladas totais de cada insumo
      const tBrita   = toneladasMistura * fracBrita;
      const tPo      = toneladasMistura * fracPo;
      const tAreia   = toneladasMistura * fracAreia;
      const tEmulsao = toneladasMistura * fracEmulsao;

      // Conversão areia: t -> m³ (para custo, já que o preço é em R$/m³)
      const volumeAreiaTotalM3 = tAreia / densAreia;

      // Custos por insumo (materiais)
      const valorBrita   = tBrita   * precoTonBrita;
      const valorPo      = tPo      * precoTonPo;
      const valorAreia   = volumeAreiaTotalM3 * precoM3Areia;
      const valorEmulsao = tEmulsao * precoTonEmulsao;

      const totalMateriais = valorBrita + valorPo + valorAreia + valorEmulsao;
      const valorMaoDeObra = totalMateriais * percMaoDeObra;
      const totalComMO = totalMateriais + valorMaoDeObra;

      // Áreas e comprimentos (largura 7m)
      const area3 = m3Asfalto / 0.03;
      const area4 = m3Asfalto / 0.04;
      const area5 = m3Asfalto / 0.05;

      const comp3 = area3 / 7;
      const comp4 = area4 / 7;
      const comp5 = area5 / 7;

      // Custos unitários
      const custoM3Total = custoTonTotal / r.m3PorTon;
      const custoM2_3 = custoM3Total * 0.03;
      const custoM2_4 = custoM3Total * 0.04;
      const custoM2_5 = custoM3Total * 0.05;

      // Valor por tonelada de cada item (para exibir em Custos Totais)
      // Areia: converter R$/m³ para R$/t via densidade (t/m³)
      const valorTonAreia = densAreia > 0 ? (precoM3Areia / densAreia) : 0;

      document.getElementById('resultado').innerHTML = `
        <h3 style="margin-top:0;">Resultados</h3>

        <table>
          <tr>
            <th class="left">Indicador</th>
            <th>Valor</th>
          </tr>
          <tr>
            <td class="left"><strong>Produção estimada</strong></td>
            <td>${formatarBR(m3Asfalto)} m³ (${formatarBR(toneladasMistura)} t de mistura)</td>
          </tr>
          <tr>
            <td class="left"><strong>Densidade adotada da mistura</strong></td>
            <td>${formatarBR(r.densMistura)} t/m³ (m³/t = ${formatarBR(r.m3PorTon)})</td>
          </tr>
        </table>

        <h3>Traço por tonelada de mistura (em toneladas)</h3>
        <table>
          <tr>
            <th class="left">Componente</th>
            <th>t por 1 t de mistura</th>
          </tr>
          <tr>
            <td class="left">Brita 0</td>
            <td>${formatarBR(tBritaPorTonMist)}</td>
          </tr>
          <tr>
            <td class="left">Pó de Pedra</td>
            <td>${formatarBR(tPoPorTonMist)}</td>
          </tr>
          <tr>
            <td class="left">Areia</td>
            <td>${formatarBR(tAreiaPorTonMist)}</td>
          </tr>
          <tr>
            <td class="left">Emulsão RL-1C</td>
            <td>${formatarBR(tEmulsaoPorTonMist)}</td>
          </tr>
        </table>

        <h3>Áreas pavimentadas a 7 metros de largura</h3>
        <table>
          <tr>
            <th>Espessura</th>
            <th>Área (m²)</th>
            <th>Extensão (m)</th>
          </tr>
          <tr>
            <td>3 cm</td>
            <td>${formatarBR(area3)}</td>
            <td>${formatarBR(comp3)}</td>
          </tr>
          <tr>
            <td>4 cm</td>
            <td>${formatarBR(area4)}</td>
            <td>${formatarBR(comp4)}</td>
          </tr>
          <tr>
            <td>5 cm</td>
            <td>${formatarBR(area5)}</td>
            <td>${formatarBR(comp5)}</td>
          </tr>
        </table>

        <h3>Custos</h3>
        <table>
          <tr>
            <th class="left">Item</th>
            <th>Valor</th>
          </tr>
          <tr>
            <td class="left">Custo por tonelada (apenas materiais)</td>
            <td>R$ ${formatarBR(custoTonMateriais)}</td>
          </tr>
          <tr>
            <td class="left">Custo por tonelada (materiais + mão de obra)</td>
            <td>R$ ${formatarBR(custoTonTotal)}</td>
          </tr>
          <tr>
            <td class="left">Custo por m³ (total)</td>
            <td>R$ ${formatarBR(custoM3Total)}</td>
          </tr>
          <tr>
            <td class="left">Custo por m² (3 cm)</td>
            <td>R$ ${formatarBR(custoM2_3)}</td>
          </tr>
          <tr>
            <td class="left">Custo por m² (4 cm)</td>
            <td>R$ ${formatarBR(custoM2_4)}</td>
          </tr>
          <tr>
            <td class="left">Custo por m² (5 cm)</td>
            <td>R$ ${formatarBR(custoM2_5)}</td>
          </tr>
        </table>

        <h3>Custos da Mão de Obra</h3>
        <table>
          <tr>
            <th class="left">Item</th>
            <th>Valor</th>
          </tr>
          <tr>
            <td class="left">Percentual aplicado</td>
            <td>${formatarBR(percMaoDeObra * 100)} %</td>
          </tr>
          <tr>
            <td class="left">Valor total da mão de obra</td>
            <td>R$ ${formatarBR(valorMaoDeObra)}</td>
          </tr>
        </table>

        <h3>Custos Totais</h3>
        <table>
          <tr>
            <th class="left">Insumo</th>
            <th>Preço unitário</th>
            <th>Quantidade</th>
            <th>Custo total</th>
          </tr>
          <tr>
            <td class="left">Brita 0</td>
            <td>R$ ${formatarBR(precoTonBrita)} / t</td>
            <td>${formatarBR(tBrita)} t</td>
            <td>R$ ${formatarBR(valorBrita)}</td>
          </tr>
          <tr>
            <td class="left">Pó de Pedra</td>
            <td>R$ ${formatarBR(precoTonPo)} / t</td>
            <td>${formatarBR(tPo)} t</td>
            <td>R$ ${formatarBR(valorPo)}</td>
          </tr>
          <tr>
            <td class="left">Areia</td>
            <td>R$ ${formatarBR(valorTonAreia)} / t (equivalente)</td>
            <td>${formatarBR(tAreia)} t</td>
            <td>R$ ${formatarBR(valorAreia)}</td>
          </tr>
          <tr>
            <td class="left">Emulsão RL-1C</td>
            <td>R$ ${formatarBR(precoTonEmulsao)} / t</td>
            <td>${formatarBR(tEmulsao)} t</td>
            <td>R$ ${formatarBR(valorEmulsao)}</td>
          </tr>
          <tr class="total-row">
            <td class="left" colspan="3">Total de materiais</td>
            <td>R$ ${formatarBR(totalMateriais)}</td>
          </tr>
          <tr class="total-row">
            <td class="left" colspan="3">Custo da mão de obra</td>
            <td>R$ ${formatarBR(valorMaoDeObra)}</td>
          </tr>
          <tr class="total-row">
            <td class="left" colspan="3">Total geral do serviço</td>
            <td>R$ ${formatarBR(totalComMO)}</td>
          </tr>
        </table>
      `;
    }
  </script>
</body>
</html>

